<%- layout('layouts/main') %>

<section class="section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="success-container text-center">
                    <!-- Success Animation -->
                    <div class="success-icon">
                        <i class="bi bi-check-circle-fill"></i>
                    </div>
                    
                    <h1 class="success-title">Â¡Pago Exitoso!</h1>
                    <p class="success-subtitle">
                        Tu orden ha sido procesada correctamente
                    </p>
                    
                    <% if (typeof order !== 'undefined' && order) { %>
                        <div class="order-confirmation card">
                            <div class="card-body">
                                <div class="order-number mb-4">
                                    <span class="label">NÃºmero de orden</span>
                                    <span class="number">#<%= order.numero_orden || order.id_pedido %></span>
                                </div>
                                
                                <div class="order-details">
                                    <div class="detail-item">
                                        <i class="bi bi-calendar3"></i>
                                        <div>
                                            <span class="detail-label">Fecha</span>
                                            <span class="detail-value">
                                                <%= new Date(order.fecha_creacion || new Date()).toLocaleDateString('es-ES', { 
                                                    weekday: 'long', 
                                                    year: 'numeric', 
                                                    month: 'long', 
                                                    day: 'numeric' 
                                                }) %>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="detail-item">
                                        <i class="bi bi-credit-card"></i>
                                        <div>
                                            <span class="detail-label">MÃ©todo de pago</span>
                                            <span class="detail-value"><%= order.metodo_pago || 'Tarjeta' %></span>
                                        </div>
                                    </div>
                                    
                                    <div class="detail-item">
                                        <i class="bi bi-cash-stack"></i>
                                        <div>
                                            <span class="detail-label">Total pagado</span>
                                            <span class="detail-value">$<%= (order.total || 0).toFixed(2) %></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <% if (typeof order.items !== 'undefined' && order.items && order.items.length > 0) { %>
                                    <hr>
                                    <h5 class="mb-3">ArtÃ­culos</h5>
                                    <div class="order-items-list">
                                        <% order.items.forEach(item => { %>
                                            <div class="order-item-row">
                                                <span class="item-qty"><%= item.cantidad %>x</span>
                                                <span class="item-name"><%= item.nombre %></span>
                                                <span class="item-type badge">
                                                    <%= item.tipo === 'producto' ? 'Producto' : 
                                                        item.tipo === 'curso' ? 'Curso' : 'Servicio' %>
                                                </span>
                                                <span class="item-total">$<%= (item.precio_unitario * item.cantidad).toFixed(2) %></span>
                                            </div>
                                        <% }); %>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    <% } %>
                    
                    <!-- Next Steps -->
                    <div class="next-steps card mt-4">
                        <div class="card-body">
                            <h5 class="mb-3"><i class="bi bi-info-circle"></i> Â¿QuÃ© sigue?</h5>
                            <div class="steps-list">
                                <% if (typeof hasProducts !== 'undefined' && hasProducts) { %>
                                    <div class="step-item">
                                        <div class="step-icon">
                                            <i class="bi bi-envelope"></i>
                                        </div>
                                        <div class="step-text">
                                            <strong>ConfirmaciÃ³n por email</strong>
                                            <p>RecibirÃ¡s un correo con los detalles de tu pedido</p>
                                        </div>
                                    </div>
                                    <div class="step-item">
                                        <div class="step-icon">
                                            <i class="bi bi-box-seam"></i>
                                        </div>
                                        <div class="step-text">
                                            <strong>PreparaciÃ³n del envÃ­o</strong>
                                            <p>Prepararemos tu pedido en las prÃ³ximas 24-48 horas</p>
                                        </div>
                                    </div>
                                    <div class="step-item">
                                        <div class="step-icon">
                                            <i class="bi bi-truck"></i>
                                        </div>
                                        <div class="step-text">
                                            <strong>Seguimiento del envÃ­o</strong>
                                            <p>Te enviaremos el cÃ³digo de rastreo por email</p>
                                        </div>
                                    </div>
                                <% } %>
                                
                                <% if (typeof hasCourses !== 'undefined' && hasCourses) { %>
                                    <div class="step-item">
                                        <div class="step-icon">
                                            <i class="bi bi-mortarboard"></i>
                                        </div>
                                        <div class="step-text">
                                            <strong>Acceso a cursos</strong>
                                            <p>Ya tienes acceso a tus cursos. Ve a tu perfil para comenzar</p>
                                        </div>
                                    </div>
                                <% } %>
                                
                                <% if (typeof hasServices !== 'undefined' && hasServices) { %>
                                    <div class="step-item">
                                        <div class="step-icon">
                                            <i class="bi bi-calendar-check"></i>
                                        </div>
                                        <div class="step-text">
                                            <strong>ConfirmaciÃ³n de cita</strong>
                                            <p>Te contactaremos para confirmar la fecha y hora del servicio</p>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Actions -->
                    <div class="success-actions mt-4">
                        <a href="/perfil/pedidos" class="btn btn-primary">
                            <i class="bi bi-bag"></i> Ver mis pedidos
                        </a>
                        <a href="/" class="btn btn-outline">
                            <i class="bi bi-house"></i> Volver al inicio
                        </a>
                    </div>
                    
                    <!-- Share -->
                    <div class="share-section mt-5">
                        <p class="text-muted small mb-2">Â¿Te gustÃ³ tu experiencia? Â¡CompÃ¡rtelo!</p>
                        <div class="share-buttons">
                            <a href="#" class="share-btn" onclick="shareOnFacebook()">
                                <i class="bi bi-facebook"></i>
                            </a>
                            <a href="#" class="share-btn" onclick="shareOnTwitter()">
                                <i class="bi bi-twitter-x"></i>
                            </a>
                            <a href="#" class="share-btn" onclick="shareOnWhatsApp()">
                                <i class="bi bi-whatsapp"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
.success-container {
    padding: var(--space-8) 0;
}

.success-icon {
    font-size: 5rem;
    color: var(--accent);
    animation: scaleIn 0.5s ease-out;
}

@keyframes scaleIn {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.success-title {
    font-size: 2.5rem;
    margin-top: var(--space-4);
    color: var(--text-primary);
}

.success-subtitle {
    font-size: 1.25rem;
    color: var(--text-secondary);
    margin-bottom: var(--space-6);
}

.order-confirmation {
    max-width: 500px;
    margin: 0 auto;
    text-align: left;
}

.order-number {
    text-align: center;
    padding: var(--space-4);
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
}

.order-number .label {
    display: block;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.order-number .number {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent);
    font-family: var(--font-mono);
}

.order-details {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
}

.detail-item {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-3);
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
}

.detail-item i {
    font-size: 1.5rem;
    color: var(--accent);
}

.detail-label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.detail-value {
    display: block;
    font-weight: 500;
}

.order-items-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.order-item-row {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2);
    background: var(--bg-secondary);
    border-radius: var(--radius-sm);
    font-size: 0.875rem;
}

.order-item-row .item-qty {
    color: var(--text-secondary);
}

.order-item-row .item-name {
    flex: 1;
}

.order-item-row .item-total {
    font-weight: 600;
}

.next-steps {
    max-width: 500px;
    margin: 0 auto;
    text-align: left;
}

.steps-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.step-item {
    display: flex;
    gap: var(--space-3);
}

.step-icon {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    color: var(--accent);
    font-size: 1.25rem;
    flex-shrink: 0;
}

.step-text strong {
    display: block;
    margin-bottom: var(--space-1);
}

.step-text p {
    margin: 0;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.success-actions {
    display: flex;
    gap: var(--space-3);
    justify-content: center;
    flex-wrap: wrap;
}

.share-section {
    padding-top: var(--space-4);
    border-top: 1px solid var(--border-color);
}

.share-buttons {
    display: flex;
    gap: var(--space-3);
    justify-content: center;
}

.share-btn {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    color: var(--text-secondary);
    transition: all var(--transition-normal);
}

.share-btn:hover {
    background: var(--accent);
    color: var(--bg-primary);
}
</style>

<script>
function shareOnFacebook() {
    const url = encodeURIComponent(window.location.origin);
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
}

function shareOnTwitter() {
    const text = encodeURIComponent('Â¡Acabo de comprar en TechLand! ðŸŽ‰');
    const url = encodeURIComponent(window.location.origin);
    window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
}

function shareOnWhatsApp() {
    const text = encodeURIComponent('Â¡Te recomiendo TechLand para productos tech y cursos de reparaciÃ³n! ' + window.location.origin);
    window.open(`https://wa.me/?text=${text}`, '_blank');
}
</script>